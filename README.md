# cldemo-vxlan

This uses reference topology.

Leaf01/Leaf02 and Leaf03/Leaf04 are configured in CLAG pairs.

vlan-aware bridging is configured.

VLAN 13 is configured as an access port to server01 and server03

VLAN 24 is configured as an access port to server02 and server04

VNI13 and VNI24 are configured between the CLAG pairs.

They are misconfigured as trunk ports carrying both vlan 13 and 24.

When a server originated broadcast packet is sent out a loop will occur between the anycast addresses, between VNIs.

It appears that a packet received on on VNI is flooded to the other VNI and looped around.

Running tcpdump on leaf03 VNI24, shows an ARP request generated by server01 in VLAN13.

```
cumulus@leaf03:~$ sudo tcpdump -i vni24 -vv
tcpdump: listening on vni24, link-type EN10MB (Ethernet), capture size 262144 bytes
19:34:58.410258 ARP, Ethernet (len 6), IPv4 (len 4), Request who-has 10.1.3.22 tell 10.1.3.101, length 46
19:34:58.410299 ARP, Ethernet (len 6), IPv4 (len 4), Request who-has 10.1.3.22 tell 10.1.3.101, length 46
19:34:58.410630 ARP, Ethernet (len 6), IPv4 (len 4), Request who-has 10.1.3.22 tell 10.1.3.101, length 46
19:34:58.410966 ARP, Ethernet (len 6), IPv4 (len 4), Request who-has 10.1.3.22 tell 10.1.3.101, length 46
19:34:58.411534 ARP, Ethernet (len 6), IPv4 (len 4), Request who-has 10.1.3.22 tell 10.1.3.101, length 46
19:34:58.411838 ARP, Ethernet (len 6), IPv4 (len 4), Request who-has 10.1.3.22 tell 10.1.3.101, length 46
```

10.1.3.22 is a bogus IP address used to cause an ARP request. 10.1.3.101 is the IP address of server01

Capturing on the fabric port sees traffic between the leaf anycast IPs looping in both VNIs.

```
cumulus@leaf03:~$ sudo tcpdump -i swp52
tcpdump: verbose output suppressed, use -v or -vv for full protocol decode
listening on swp52, link-type EN10MB (Ethernet), capture size 262144 bytes
19:35:42.671621 IP 10.10.10.1.59606 > 10.10.10.2.4789: VXLAN, flags [I] (0x08), vni 13
ARP, Request who-has 10.1.3.22 tell 10.1.3.101, length 46
19:35:42.671644 IP 10.10.10.1.59606 > 10.10.10.2.4789: VXLAN, flags [I] (0x08), vni 13
ARP, Request who-has 10.1.3.22 tell 10.1.3.101, length 46
19:35:42.671647 IP 10.10.10.1.59606 > 10.10.10.2.4789: VXLAN, flags [I] (0x08), vni 24
ARP, Request who-has 10.1.3.22 tell 10.1.3.101, length 46
19:35:42.671651 IP 10.10.10.1.59606 > 10.10.10.2.4789: VXLAN, flags [I] (0x08), vni 13
ARP, Request who-has 10.1.3.22 tell 10.1.3.101, length 46
19:35:42.671653 IP 10.10.10.1.59606 > 10.10.10.2.4789: VXLAN, flags [I] (0x08), vni 24
ARP, Request who-has 10.1.3.22 tell 10.1.3.101, length 46
19:35:42.671655 IP 10.10.10.1.59606 > 10.10.10.2.4789: VXLAN, flags [I] (0x08), vni 13
```


