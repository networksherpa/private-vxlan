---
- name: Get VTEP VxLANs
  command: vxrdctl vxlans -j
  register: vxrd_vxlans_output
  when: vxrd[ansible_hostname] is defined

- name: Get VTEP Peers
  command: vxrdctl peers -j
  register: vxrd_peers_output
  when: vxrd[ansible_hostname] is defined

- name: Process VTEP VxLAN Data
  set_fact:
    configured_vxlans: "{{vxrd_vxlans_output.stdout | from_json}}"
  when: vxrd[ansible_hostname] is defined

- name: Process VTEP Peer Data
  set_fact:
    configured_vxlans: "{{vxrd_peers_output.stdout | from_json}}"
  when: vxrd[ansible_hostname] is defined

- name: Validate VNIs
  assert:
    that:
      - "{{item}}" in configured_vxlans.keys()
  with_items: vxrd[ansible_hostname].vnis
  when: vxrd[ansible_hostname] is defined

#cumulus@leaf01:~$ sudo vxrdctl vxlans -j
#{"24": {"dev_name": "vni24", "svcnodeip": "10.255.255.10", "hrep_addrs": ["10.10.10.3", "10.10.10.2"], "localip": "10.10.10.1"}, "13": {"dev_name": "vni13", "svcnodeip": "10.255.255.10", "hrep_addrs": ["10.10.10.3", "10.10.10.2"], "localip": "10.10.10.1"}}

  #     - clag[ansible_hostname].priority == configured_clag["status"]["ourPriority"]
  #     - clag[ansible_hostname].role == configured_clag["status"]["ourRole"]
  #     - clag[ansible_hostname].system_mac == configured_clag["status"]["sysMac"]
  #     - clag[ansible_hostname].anycast == configured_clag["status"]["vxlanAnycast"]
  #     - clag[ansible_hostname].backup_ip == configured_clag["status"]["backupIp"]
  #     - clag[ansible_hostname].peer_ip == configured_clag["status"]["peerIp"]
  # when: clag[ansible_hostname] is defined
